<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promoções Portal - Monitor 2</title>
    <style>
        :root {
            /* Variáveis controladas pelo App Python */
            --bg-cor: #8B4513;
            --padding-tv: 40px;
            --font-nome: 2.2em;
            --font-preco: 3em;
            --cor-primaria: #FFD700;
        }

        body {
            background-color: var(--bg-cor);
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Impact, sans-serif;
            overflow: hidden;
            height: 100vh;
            color: white;
            transition: background 0.5s ease;
        }

        .externo {
            padding: var(--padding-tv);
            height: 100vh;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            border: 8px solid var(--cor-primaria);
            border-radius: 30px;
            display: grid;
            grid-template-columns: 1.2fr 0.8fr; /* Padrão: Tabela | Foto */
            gap: 20px;
            padding: 30px;
            box-sizing: border-box;
            transition: all 0.5s ease-in-out;
        }

        /* Classe aplicada quando 'mostrar_ofertas' for falso */
        .layout-cheio {
            grid-template-columns: 1fr !important;
        }

        .area-tabela {
            display: flex;
            flex-direction: column;
        }

        .titulo {
            font-size: 4em;
            text-align: center;
            color: var(--cor-primaria);
            margin: 0 0 20px 0;
            text-transform: uppercase;
            border-bottom: 4px solid var(--cor-primaria);
            text-shadow: 3px 3px 0px #000;
        }

        .grid-precos {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2 colunas */
            gap: 15px;
            align-content: start;
        }

        .layout-cheio .grid-precos {
            grid-template-columns: 1fr 1fr 1fr; /* 3 colunas em tela cheia */
        }

        .item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 20px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 8px solid var(--cor-primaria);
        }

        .nome { font-size: var(--font-nome); font-weight: bold; text-transform: uppercase; }
        .preco { font-size: var(--font-preco); color: #00ff00; font-weight: 900; }

        /* Painel Lateral de Foto */
        .painel-foto {
            background: #cc0000;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            animation: pulsar 2s infinite;
        }

        .painel-foto img {
            max-width: 90%;
            max-height: 50%;
            border: 6px solid white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        .oferta-nome { font-size: 3.5em; color: yellow; text-transform: uppercase; margin: 0; }
        .oferta-preco { font-size: 6em; font-weight: 900; margin: 0; }

        @keyframes pulsar {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <div class="externo">
        <div id="wrapper" class="container">
            <div class="area-tabela">
                <h1 id="titulo-categoria" class="titulo">OFERTAS</h1>
                <div id="grid-itens" class="grid-precos">
                    </div>
            </div>

            <div id="bloco-foto" class="painel-foto">
                <h2 style="font-size: 2.5em; margin: 0;">OFERTA DO DIA</h2>
                <img id="img-destaque" src="" alt="">
                <p id="nome-destaque" class="oferta-nome"></p>
                <p id="preco-destaque" class="oferta-preco"></p>
            </div>
        </div>
    </div>

    <script>
        let indexOferta = 0;

        async function carregarDados() {
            try {
                const r = await fetch(`precos.json?nocache=${new Date().getTime()}`);
                const d = await r.json();
                const cfg = d.config_promocoes;

                // 1. Aplicar Configurações Visuais
                document.documentElement.style.setProperty('--bg-cor', cfg.bg_color);
                document.documentElement.style.setProperty('--padding-tv', cfg.padding_tv);
                document.documentElement.style.setProperty('--font-nome', cfg.font_size_nome);
                document.documentElement.style.setProperty('--font-preco', cfg.font_size_preco);

                // 2. Controlar Exibição do Painel de Fotos
                const wrapper = document.getElementById('wrapper');
                const blocoFoto = document.getElementById('bloco-foto');
                
                if (cfg.mostrar_ofertas) {
                    wrapper.classList.remove('layout-cheio');
                    blocoFoto.style.display = "flex";
                } else {
                    wrapper.classList.add('layout-cheio');
                    blocoFoto.style.display = "none";
                }

                // 3. Renderizar Lista de Promoções
                const cat = cfg.categoria_mostrar;
                document.getElementById('titulo-categoria').innerText = `PROMOÇÃO ${cat.toUpperCase()}`;
                
                const itens = d.promocoes.filter(p => p.categoria === cat);
                document.getElementById('grid-itens').innerHTML = itens.map(i => `
                    <div class="item">
                        <span class="nome">${i.nome}</span>
                        <span class="preco">R$ ${i.preco_promocao}</span>
                    </div>
                `).join('');

                // 4. Rotacionar Destaques da Galeria
                if (d.ofertas && d.ofertas.length > 0) {
                    const off = d.ofertas[indexOferta];
                    document.getElementById('img-destaque').src = off.imagem;
                    document.getElementById('nome-destaque').innerText = off.nome;
                    document.getElementById('preco-destaque').innerText = `R$ ${off.preco}`;
                    indexOferta = (indexOferta + 1) % d.ofertas.length;
                }

            } catch (e) { console.log("Erro ao carregar JSON:", e); }
        }

        setInterval(carregarDados, 10000);
        carregarDados();
    </script>
</body>
</html>
